const c="ucam.uiu.ac.bd",d="v.0.0.2",o="https://cloud.appwrite.io/v1",i="66e952880028feea0f79",l="banner_1";async function u(){await fetch(`${o}/databases/666e8c56000c1b9527a8/collections/public/documents/${d}`,{method:"GET",headers:{"X-Appwrite-Project":"666e75190023d8fb2104","Content-Type":"application/json"},redirect:"follow"}).then(async e=>{const t=await e.json();chrome.storage.sync.set({extentionServerData:t})}).catch(e=>console.log("error while getting extension info",e))}async function s(){await fetch(`${o}/databases/666e8c56000c1b9527a8/collections/banner/documents/${l}`,{method:"GET",headers:{"X-Appwrite-Project":"666e75190023d8fb2104","Content-Type":"application/json"},redirect:"follow"}).then(async e=>{const t=await e.json();chrome.storage.sync.set({extentionBannerData:t})}).catch(e=>console.log("error",e)),r({}).catch(e=>console.log("error while saving user info",e))}async function h(){return await new Promise(n=>{chrome.storage.sync.get(["userObj"],t=>{n(t.userObj||null)})})}chrome.tabs.onUpdated.addListener(async(e,n,t)=>{if(t.url&&t.url.includes(c)&&n.status==="complete"){const a=new URL(t.url);a.pathname.includes("Login")?await chrome.storage.sync.remove("userObj"):a.pathname.includes("StudentHome")?chrome.tabs.sendMessage(e,{type:"GET_USER_INFO"}):chrome.tabs.sendMessage(e,{type:"PAGE_UPDATED"}),s()}});function f(e){chrome.storage.sync.get(["alreadySavedIds"],n=>{(n.alreadySavedIds||[]).includes(e.studentId)||fetch(`${o}/databases/666e8c56000c1b9527a8/collections/${i}/documents`,{method:"POST",headers:{"X-Appwrite-Project":"666e75190023d8fb2104","Content-Type":"application/json"},body:JSON.stringify({documentId:e.studentId,data:{uiu_id:e.studentId,full_name:e.full_name,dob:e.date_of_birth,phone:e.phone_number,avatar:e.avatar_url}}),redirect:"follow"}).then(a=>{}).then(a=>{}).catch(a=>{a.status===409&&chrome.storage.sync.set({alreadySavedIds:[e.studentId]})})})}async function r(e){const n=e,t=await h();n.studentId&&(n.last_updated=new Date().toDateString(),n.studentId!==(t==null?void 0:t.studentId)&&f(n)),chrome.storage.sync.set({userObj:n})}chrome.runtime.onInstalled.addListener(()=>{console.log("Background service worker installed"),u(),s()});chrome.runtime.onStartup.addListener(()=>{console.log("Background service worker started")});chrome.runtime.onMessage.addListener(e=>(e.type==="SAVE_USER_INFO"&&r(e.data),!0));
